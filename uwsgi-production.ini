[uwsgi]
# Application
wsgi-file = main.py
callable = app
module = main:app

# Socket configuration - Port is set via command line --http flag
# DO NOT set http or http-socket here, it's set in start-uwsgi.sh
http-allow-methods = GET, POST, PUT, PATCH, DELETE, OPTIONS

# Process management - Optimized for Cloud Run
master = true
processes = 1
threads = 4
enable-threads = true

# Lazy loading - faster startup
lazy-apps = true

# Timeouts - Critical for Cloud Run
harakiri = 120
http-timeout = 120
socket-timeout = 120

# Logging to stdout (CRITICAL for Cloud Run)
logto = /dev/stdout
log-4xx = true
log-5xx = true
disable-logging = false
log-date = true
log-format = %(addr) - %(user) [%(ltime)] "%(method) %(uri) %(proto)" %(status) %(size) "%(referer)" "%(uagent)"

# Graceful shutdown
die-on-term = true
vacuum = true
max-requests = 1000

# Buffer sizes - important for Cloud Run
buffer-size = 8192
post-buffering = 8192

# Note: CORS handled by Flask-CORS in main.py
